[SERVICE]
    Parsers_File fluent-bit/parsers/parsers.conf
    Flush 1
    Grace 30

[FILTER]
    Name multiline
    Match *
    multiline.key_content log
    mode partial_message

[FILTER]
    Name parser
    Match *
    Key_Name log
    Parser nginx 

[OUTPUT]
    Name cloudwatch_logs
    Match *
    region ap-northeast-1
    log_group_name /ecs/${project}/${env}/${task_role}
    log_stream_name ecs
    auto_create_group true

[OUTPUT]
    Name s3
    Match *
    bucket ${logging_bucket_name}
    region ap-northeast-1
    total_file_size  1M
    use_put_object On
    compression gzip
    s3_key_format /$TAG/%Y/%m/%d/%H/%M/%S/$UUID.gz